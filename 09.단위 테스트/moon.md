# 단위 테스트
- 우리들 대다수에게 단위 테스트란 자기 프로그램이 돌아간다는 사실만 확인하는 일회성 코드에 불과하다.
- 우리 분야는 지금까지 눈부신 성장을 하였지만, 제대로 된 테스트 케이를 작성 해야한다는 사실을 놓쳐 버렸다.

## TDD 법칙 세가지
- 첫째 법칙: 실패하는 단위 테스트를 작성할 때까지 실제 코드를 장성하지 않는다.
- 둘째 법칙: 컴파일은 실패하지 않으면서 실행이 실패하는 정도로만 단위 테스트를 작성한다.
- 셋째 법칙: 현재 실패하는 테스트를 통과할 정도로만 실제 코드를 적는다.
- 위 세가지 규칙을 따르면 개발과 테스트가 대략 30초 주기로 묶인다.
- 또한 방대한 양의 테스트 코드가 나오게된다. 하지만 실제 코드와 맞먹을 정도로 방대한 테스트 코드는 심각한 관리 문제를 유발하기도 한다.

## 깨끗한 테스트 코드 유지하기
- 지저분한 테스트 코드를 내놓으나 테스트를 안하나 똑같다.
- 실제 코드가 진화하면 테스트 코드가 변해야 해서 지저분한 테스트 코드는 점점 부담이 되버린다.
- 지전분한 테스트 코드는 점차 개발자 사이에서 큰 불만으로 된다. 결국 테스트 슈트를 폐기하지 않으면 안 되는 상황에 쳐한다.
- 하지만 테스트 슈트가 없으면 시스템 이쪽을 수정해도 저쪽이 안전하다는 사실을 검증하지 못한다. 그래서 결함율이 높아지기 시작한다.
- 결국 테스트 슈트도 없고, 뒤섞인 코드에, 좌절한 고객과 테스트에 쏟아 부은 노력이 허사였다는 실망감만 남는다.
- 테스트 코드를 막 짜도 좋다고 혀용한 결정이 문제였다.
- 테스트 코드는 실제 코드 못지 않게 중요하여 실제 코드 못지 않게 깨끗하게 짜야한다.

### 테스트는 유연성, 유지보수성, 재사용성을 제공한다.
- 코드에 유연성, 유지보수성, 재사용성를 제공하는 버팀목이 바로 단위 테스트다.
- 테스트 케이스가 없으면 개발자는 변경을 주저한다.
- 하지만 테스트 케이스가 있다면 코드 변경에 공포는 사실상 사라진다. 테스트 커버리지가 높을수록 코드 변경에 공포는 줄어든다.
- 그러므로 실제 코드를 점검하는 자동화된 단위 테스트 슈트는 설계와 아키텍처를 최대한 깨끗하게 보존하는 열쇠다.

## 꺠끗한 테스트 코드
- 깨끗한 테스트 코드를 만들려면 가독성이 제일 중요하다.
- 가독성을 높이려면 코드와 마찬가지로 명료성, 단순성, 풍부한 표현력이 필요하다.
- 잡다하고 세세한 코드를 거의 다 없애고, 테스트 코드는 본론에 돌입해 진짜 필요한 자료 유형과 함수만 사용한다.

### 도메인에 특화된 테스트 언어
- 시스템 조작 API를 사용하는 대신 API위에다 함수와 유틸리티를 구현한 후 그 함수와 유틸리티를 사용하므로 테스트 코드를 짜기도 읽기도 쉬워진다.
- 이렇게 구현한 함수와 유틸리티는 테스트 코드에서 사용하는 특수 API가 된다. 즉 테스트 언어다.

### 이중 표준
- 테스트 API코드에 적용하는 표준은 실제 코드에 적용하는 표준과 확실히 다르다. 단순하고, 간결하고, 표현력이 풍부해야 하지만, 실제 코드만큼 효율적일 필요는 없다.
- 실제 환경이 아니라 테스트 환경에서 돌아가는 코드이기 때문이다.
- 실제 환경에서는 절대로 안되지만 테스트 환경에서는 전혀 문제없는 방식이 존재하는데 이것이 이중 표준의 본질이다.
- 대게 메모리나 CPU 효율과 관련 있는 경우다. 코드의 깨끗함과는 철저히 무관하다.

## 테스트 당 assert 하나
- assert문이 단 하나인 함수는 결론이 하나라서 코드를 이해하기 쉽고 빠르다.
- 테스트를 두 개로 쪼개 각자가 assert를 수행하면 된다.
- 필자는 assert 문 개수는 최대한 줄려야 좋다는 생각이다.

### 테스트 당 개념 하나
- 이것저것 잡다한 개념을 연속으로 테스트하는 긴 함수는 피한다.
- 독자적인 개념 세개를 테스트해야 한다면 독자적인 테스트 세 개로 쪼개야 마땅하다.
- 가장 좋은 규칙은 개념 당 assert 문 수를 최소로 줄여라와 테스트 함수 하나는 개념 하나만 테스트 하라라 하겠다.

## F.I.R.S.T
- 깨끗한 테스트는 5가지 규칙을 따르는데, 각 규칙에서 첫글자만 떼면 FIRST가 된다.
- Fast : 테스트는 빨라야한다. 느리면 자주 돌린 엄두를 못낸다.
- Indenpendent : 각 테스트는 서로 의존하면 안된다. 테스트가 서로에게 의존하면 하나가 실패할때 나머지도 잇달아 실패해 원인을 찾기가 힘들어진다.
- Repeatable : 테스트는 어떤 환경에서도 반복 가능해야 한다. 테스트가 돌아가지 않는 환경이 하나라도 있다면 테스트가 실패한 이유를 둘러댈 변명이 생긴다.
- Self-Validating : 테스트는 bool값으로 결과를 내야 한다. 성공 아니면 실패다. 테스트가 스스로 성공과 실패를 가늠하지 않으면 판단은 주관적으로 되며 수작업이 필요해진다.
- Timely : 테스트는 적시에 작성해야 한다. 단위 테스트는 테스트하려는 실제 코드를 구현하기 직전에 구현한다. 실제 코드를 구현한 다음에 테스트 코드를 만들면 실제 코드가 테스트 하기 어렵다는 사실을 발견할지도 모른다.

## 결론
- 사실상 깨끗한 테스트 코드라는 주제는 책 한권을 할애해도 모자란 주제다.
- 테스트 코드는 실제 코드 보다 더 중요할지도 모른다. 그러므로 지속적으로 깨끗하게 관리하자.
- 테스트 코드가 방치되어 망가지면 실제 코드도 망가진다.
